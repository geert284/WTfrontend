<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="mystyle.css">

    <script src="js/common.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

</head>
<body onload="checkAdmin()">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>


    <script>

        function checkAdmin() {
            let admin = localStorage.getItem('WT_ADMIN');
            if (admin == 'true') {
                document.getElementById("adminSpan").style.display = "block";
            }
        }

        function switchTable() {
            var selectedTable = document.getElementById("book-options").value;
            if (selectedTable == "Exemplaren") {
                document.getElementById("bookadmin-table").style.display = "none";
                document.getElementById("copyadmin-table").style.display = "table";
            } else {
                document.getElementById("copyadmin-table").style.display = "none";
                document.getElementById("bookadmin-table").style.display = "table";
            }
            
        }

        function searchBooksAdmin() {
            fetch('http://localhost:8080/book/all')
            .then(response => response.json())
            .then(data => { 
                    console.log('Data', data);

                    let booksAdminHtml = `
                        <tr id="table-header">
                            <td>Titel</td>
                            <td>Auteur</td>
                            <td>Categorie</td>
                            <td>Editie</td>
                            <td style="text-align: right"><button type="button" onclick="window.location.href = 'add-book.html';" class="green-button">+</button></td>
                            </tr>
                    `
                    data.forEach(book => {
                        booksAdminHtml += `
                            <tr>
                                <td>${book.title}</td>
                                <td>${book.author}</td>
                                <td>${book.category}</td>
                                <td>${book.edition}</td>
                                <td style="text-align: right"><button type="button" onclick="window.location.href = 'adjust-book.html';" class="green-button">Wijzig</button></td>
                                <td><button onclick="deleteBook(${book.id})">Delete Book</button></td>


                            </tr>
                        `
                    });

                    document.getElementById('bookadmin-table').innerHTML = booksAdminHtml;

                });
        }
        searchBooksAdmin();

        
        function deleteBook(bookId) {
            var confirmed = confirm("Are you sure you want to delete this book?");

            if (confirmed) {
                var xhr = new XMLHttpRequest();

                xhr.open('POST', 'http://localhost:8080/book/delete/' + bookId, true);
                xhr.setRequestHeader('Content-Type', 'application/json');

                var deleteBookDto = { id: bookId };


                xhr.onload = function () {
                    if (xhr.status === 200) {
                        alert('Book deleted successfully');

                        // Optionally, you can update the UI to remove the deleted book
                    } else {
                        alert('Error deleting book: ' + xhr.statusText);
                    }
                };

                xhr.send(JSON.stringify(deleteBookDto));
                
                location.reload;
                
            }
        }


        // function deleteBook(bookId) {
        //     var confirmed = confirm("Are you sure you want to delete this book?");

        //     if (confirmed) {
        //         fetch(`'http://localhost:8080/book/${book.id}/delete`, {
        //             method: 'DELETE',
        //             headers: {
        //                 'Content-Type': 'application/json'
        //             }
        //         })
        //         .then(response => {
        //             if (!response.ok) {
        //                 throw new Error(`HTTP error! status: ${response.status}`);
        //             }
        //             return response.json(); // Assuming the server sends back a JSON response
        //         })
        //         .then(data => {
        //             alert('Book deleted successfully');
        //             // Optionally, you can update the UI to remove the deleted book
        //             search();
        //             location.reload();
        //         })
        //         .catch(error => {
        //             alert('Error deleting book: ' + error.message);
        //         });
        //     }
        // }



    </script>

<nav class="navbar navbar-expand-lg navbar-light bg-light nav-underline">
    <a class="navbar-brand" href="home-page.html">
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp <!-- padding is impossible with bootstrap -->
        <img src="images/WT-logo.png" width="210" height="50" class="d-inline-block align-top" alt="">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
        <li class="nav-item active">
            <a class="nav-link" href="library.html">Bibliotheek<span class="sr-only"></span></a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="my-books.html">Mijn boeken</a>
        </li>
        <span id="adminSpan" style="display: none;">
            <li class="nav-item dropdown" id="adminDropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Administratie
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                <a class="dropdown-item" href="res-and-loans.html">
                    <img src="images/list.svg">
                    &nbsp&nbspReserveringen en leningen beheren</a>
                <a class="dropdown-item" href="manage-books.html">
                    <img src="images/book-open.svg">
                    &nbsp&nbspBoeken beheren</a>
                <a class="dropdown-item" href="manage-users.html">
                    <img src="images/users.svg">
                    &nbsp&nbspGebruikers beheren</a>
                </div>
            </li>
        </span>
        <li class="nav-item dropdown position-absolute bottom-0 end-0 translate-middle">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Mijn account&nbsp&nbsp
                <img src="images/user.svg">
            </a>
            <div class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="navbarDropdownMenuLink">
            <a class="dropdown-item" href="my-account.html">
                <img src="images/settings.svg">
                &nbsp&nbspMijn gegevens</a>
            <a class="dropdown-item" href="login-page.html">
                <img src="images/log-out.svg">
                &nbsp&nbspUitloggen</a>
            </div>
        </li>
        </ul>
    </div>
</nav>

    </div>
    <br><br><br>

    <!-- 
    <div class="sidebar">
        <br><br><br><br>
        <div style="font-weight: bold;">Filters</div>
        <hr>
        <div>Filter 1</div>
        <div>Filter 2</div>
        <div>Filter 3</div>
    </div> -->

    
    <div class="body-text">
        <h2>Boeken beheren</h2>
        
        <label for="book-options" style="margin-left: 68%;">Toon:</label>
        <select id="book-options" onchange="switchTable()">
            <option label="Boeken">Boeken</option>
            <option label="Exemplaren">Exemplaren</option>
        </select>
        <br><br>
        <table id="bookadmin-table"></table>
        <table id="copyadmin-table" style="display: none;">
            <tr id="table-header2">
                <td>Titel</td>
                <td>Auteur</td>
                <td>Categorie</td>
                <td>Editie</td>
                <td>Staat</td>
                <td>Beschikbaar</td>
                <td style="text-align: right"><button type="button" onclick="window.location.href = 'add-book.html';" class="green-button">+</button></td>
            </tr>
        </table>
    </div>

    


</body>
</html>